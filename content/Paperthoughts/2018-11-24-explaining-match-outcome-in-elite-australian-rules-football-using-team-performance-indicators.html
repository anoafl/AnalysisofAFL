---
title: Explaining Match outcome in elite australian rules football using team performance
  indicators
author: "Robert Nguyen"
date: '2018-11-23'
tags:
- academic
- modelling
- regression
---



<p>Link to paper <a href="https://www.ncbi.nlm.nih.gov/pubmed/26176890">here</a></p>
<p>As a summary, I think the paper is about seeing if “box score” data can be used to predict the winner of a game.</p>
<p>Put another way, if I were to show you the AFL stats on say footywire at the end of a game and I of course covered up the Goals and Behinds as well could you predict who won the game?</p>
<div class="figure">
<img src="/img/boxscoreafl.JPG" alt="footywire box-score adelaide" />
<p class="caption">footywire box-score adelaide</p>
</div>
<p>The good thing about this paper, is that it only uses data that is already available in <a href="https://github.com/jimmyday12/fitzRoy">#fitzRoy</a>. Of course fitzRoy wasn’t around when the paper was written, but it just so happens that the data used is also available within fitzRoy.</p>
<p>Of course there are some caveats to this. The main one being even though we have the same variables. We might not have the same data source. Nonetheless this post should be a good guide as to how to recreate and if you are so inclined maybe even improve on the work.</p>
<div id="variables-used" class="section level1">
<h1>Variables used</h1>
<p>The variables used were across the 2013 and 2014 AFL season.</p>
<p>So something that could be an interesting extension of this, is because <a href="https://www.footywire.com/">footywire</a> has made some extra statistics available like meters gained, intercepts and tackles inside 50 to name a few. You could run the same model type that the paper used say logistic regression. But you could see if variables like meters gained, intercepts and tackles added any extra value. This is why this particular part of my blog exists, because its an interesting question and one that a fan of the game can hopefully answer online.</p>
<p>Other things to note from the paper is that its not the raw team total that is being used in the model, rather relative difference values between opposing teams for each performance indicators were used.</p>
<p>What I think this means is that instead of WCE totals kicked being used it was WCE total kicks minus Collingwoods total kicks being used.</p>
<p>The other thing to note, is that the paper only talks about home and away matches so we have to filter out finals</p>
<pre class="r"><code>c(&quot;Variables used&quot;,
  &quot;Kicks&quot;,
  &quot;Marks&quot;,
  &quot;Handballs&quot;,
  &quot;Tackles&quot;,
  &quot;Inside 50s&quot;,
  &quot;Clearances&quot;,
  &quot;Clangers&quot;,
  &quot;Contested possessions&quot;,
  &quot;Uncontested possessions&quot;,
  &quot;Contested marks&quot;,
  &quot;Marks inside 50&quot;,
  &quot;Goal conversion&quot;,
  &quot;Kick:handball ratio&quot;,
  &quot;contested:uncontested possession ratio&quot;,
  &quot;disposals&quot;,
  &quot;hit outs&quot;,
  &quot;Free kick differential&quot;)</code></pre>
<pre><code>##  [1] &quot;Variables used&quot;                        
##  [2] &quot;Kicks&quot;                                 
##  [3] &quot;Marks&quot;                                 
##  [4] &quot;Handballs&quot;                             
##  [5] &quot;Tackles&quot;                               
##  [6] &quot;Inside 50s&quot;                            
##  [7] &quot;Clearances&quot;                            
##  [8] &quot;Clangers&quot;                              
##  [9] &quot;Contested possessions&quot;                 
## [10] &quot;Uncontested possessions&quot;               
## [11] &quot;Contested marks&quot;                       
## [12] &quot;Marks inside 50&quot;                       
## [13] &quot;Goal conversion&quot;                       
## [14] &quot;Kick:handball ratio&quot;                   
## [15] &quot;contested:uncontested possession ratio&quot;
## [16] &quot;disposals&quot;                             
## [17] &quot;hit outs&quot;                              
## [18] &quot;Free kick differential&quot;</code></pre>
<p>They then removed some variables from the model fitting process. For example <a href="https://en.wikipedia.org/wiki/Multicollinearity">Multicollinearity</a> is a typical problem in regression. It happens when there is a relationship between your predictor variables. In this case we know that essentially kicks + handballs = disposals which would be an example of multicollinearity.</p>
</div>
<div id="how-to-get-the-data-ready" class="section level1">
<h1>How to get the data ready</h1>
<p>To fit the models described in the paper, we would need a dataset that contains the game information joined with a binary indicator 1 if the team won and 0 if the team lost (in the paper draws were removed).</p>
<p>To do this using <a href="https://github.com/jimmyday12/fitzRoy">fitzRoy</a> would require joining <code>fitzRoy::match_results</code> onto <code>fitzRoy::player_stats</code></p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ──────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.8
## ✔ tidyr   0.8.2     ✔ stringr 1.3.1
## ✔ readr   1.3.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(fitzRoy)
library(knitr)
library(broom)
df1&lt;-fitzRoy::match_results
df2&lt;-fitzRoy::player_stats</code></pre>
<p>So once we have the box-score statistics from footywire, <code>fitzRoy::player_stats</code> we have to aggregate them to a match level. That is because the paper looked at team level statistics not player level.</p>
<p>So to do that using the <a href="https://www.tidyverse.org/learn/">tidyverse</a> we first have to come up with at what level we want to summarise our data by (team and game). To do this we use <code>group_by</code>.</p>
<pre class="r"><code>library(tidyverse)
teamdata&lt;-df2%&gt;%dplyr::select(-Player)%&gt;%
  group_by(Date, Season, Round, Venue, Team, Opposition, Status, Match_id)%&gt;%
  summarise_all(sum)%&gt;%
  filter(Season %in% c(&quot;2013&quot;,&quot;2014&quot;))%&gt;%
         group_by(Date,Season, Round, Team, Status, Opposition, Venue, Match_id)%&gt;%
         summarise_all(.funs = sum)%&gt;%
         group_by(Match_id)%&gt;%
         arrange(Match_id)%&gt;%
         mutate_if(is.numeric, funs(difference=c(-diff(.), diff(.))))%&gt;%
  filter(!Round %in% c(&quot;Qualifying Final&quot;,&quot;Elimination Final&quot;,
                       &quot;Semi Final&quot;,&quot;Preliminary Final&quot;,&quot;Grand Final&quot;  ))</code></pre>
<p>After that we would want to join on the score dataset so we can come up with win/loss column.</p>
<pre class="r"><code>dataset_scores1&lt;-df1%&gt;%dplyr::select (Date, Round, Home.Team, Home.Points,Game)
dataset_scores2&lt;-df1%&gt;%dplyr::select(Date, Round, Away.Team, Away.Points,Game)
#Sometimes when joining datasets together it helps to rename things for consistency

colnames(dataset_scores1)[3]&lt;-&quot;Team&quot;
colnames(dataset_scores1)[4]&lt;-&quot;Points&quot;
colnames(dataset_scores2)[3]&lt;-&quot;Team&quot;
colnames(dataset_scores2)[4]&lt;-&quot;Points&quot;

df5&lt;-rbind(dataset_scores1,dataset_scores2)
dataset_margins&lt;-df5%&gt;%group_by(Game)%&gt;%
  arrange(Game)%&gt;%
  mutate(margin=c(-diff(Points),diff(Points)))
# View(dataset_margins) # I have commented this out, but always good to view 
dataset_margins$Date&lt;-as.Date(dataset_margins$Date)

dataset_margins&lt;-dataset_margins %&gt;%mutate(Team = str_replace(Team, &quot;Brisbane Lions&quot;, &quot;Brisbane&quot;))

dataset_margins&lt;-dataset_margins %&gt;%mutate(Team = str_replace(Team, &quot;Footscray&quot;, &quot;Western Bulldogs&quot;))

complete_df&lt;-left_join(teamdata,dataset_margins,by=c(&quot;Date&quot;=&quot;Date&quot;,  &quot;Team&quot;=&quot;Team&quot;))</code></pre>
<p>The next step in the paper is feature creation. What this means is that we are creating some variables to be fed in the model. In this paper while it uses data available from <a href="https://github.com/jimmyday12/fitzRoy">fitzRoy</a> it also has some variables created. These variables are:</p>
<pre class="r"><code>library(knitr)
df&lt;-data.frame(stringsAsFactors=FALSE,
   Feature.created = c(&quot;Goal Conversion&quot;, &quot;Kick to handball ratio&quot;,
                       &quot;Contested to uncontested possession ratio&quot;),
       Description = c(&quot;the percentage of scoring events that were goals&quot;,
                       &quot;the number of kicks compared to handballs expressed as a ratio&quot;,
                       &quot;the number of contested possessions compared to uncontested posessessions expressed as a ratio&quot;))
df%&gt;% 
  kable(&quot;html&quot;, caption = &quot;Table of Variables Created for Paper&quot;)</code></pre>
<table>
<caption>
<span id="tab:unnamed-chunk-5">Table 1: </span>Table of Variables Created for Paper
</caption>
<thead>
<tr>
<th style="text-align:left;">
Feature.created
</th>
<th style="text-align:left;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Goal Conversion
</td>
<td style="text-align:left;">
the percentage of scoring events that were goals
</td>
</tr>
<tr>
<td style="text-align:left;">
Kick to handball ratio
</td>
<td style="text-align:left;">
the number of kicks compared to handballs expressed as a ratio
</td>
</tr>
<tr>
<td style="text-align:left;">
Contested to uncontested possession ratio
</td>
<td style="text-align:left;">
the number of contested possessions compared to uncontested posessessions expressed as a ratio
</td>
</tr>
</tbody>
</table>
<ul>
<li>goal conversion is an example of a variable that we might not be able to fully replicate. For example if the player has a shot on goal but kicks it out of bounds that isn’t recorded in fitzRoy.</li>
</ul>
<p>So lets just go ahead and create them. In the <a href="https://www.tidyverse.org/">tidyverse</a>, this would be done using the mutate function.</p>
<pre class="r"><code>dataset_model&lt;-complete_df%&gt;%filter(margin!=0)%&gt;%
  mutate(goal_conversion=(G/(G+B)),
                     kicktohandball=K/HB,
                     Contestedtouncontested=CP/UP,
                     win_loss=ifelse(margin&gt;0,1,0))%&gt;%
  mutate(kicktohandball_diff=c(-diff(kicktohandball),diff(kicktohandball)),
  Contestedtouncontested_diff=c(-diff(Contestedtouncontested),diff(Contestedtouncontested)),
  goal_conversion_diff=c(-diff(goal_conversion),diff(goal_conversion))
         )%&gt;%
  filter(!margin==0)%&gt;%
  filter(Season==2013)</code></pre>
<p>Whats the next step now we have our dataset like the paper?</p>
<p>That would be to fit a logistic regression.</p>
<pre class="r"><code>mylogit &lt;- glm(win_loss ~ K_difference + M_difference + HB_difference+T_difference+I50_difference+CL_difference+CG_difference+CP_difference+UP_difference+CM_difference+goal_conversion+kicktohandball+Contestedtouncontested
               
               ,data = dataset_model, family =&quot;binomial&quot;)
summary(mylogit)</code></pre>
<pre><code>## 
## Call:
## glm(formula = win_loss ~ K_difference + M_difference + HB_difference + 
##     T_difference + I50_difference + CL_difference + CG_difference + 
##     CP_difference + UP_difference + CM_difference + goal_conversion + 
##     kicktohandball + Contestedtouncontested, family = &quot;binomial&quot;, 
##     data = dataset_model)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.17684  -0.42682  -0.00021   0.44963   2.48144  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)            -5.098957   1.632251  -3.124 0.001785 ** 
## K_difference            0.017970   0.026365   0.682 0.495513    
## M_difference           -0.040118   0.017819  -2.251 0.024356 *  
## HB_difference          -0.045039   0.029275  -1.538 0.123927    
## T_difference            0.027667   0.014805   1.869 0.061654 .  
## I50_difference          0.065159   0.018815   3.463 0.000534 ***
## CL_difference          -0.062603   0.021532  -2.907 0.003644 ** 
## CG_difference          -0.008463   0.020111  -0.421 0.673890    
## CP_difference           0.062228   0.028254   2.202 0.027633 *  
## UP_difference           0.054032   0.028425   1.901 0.057324 .  
## CM_difference           0.057289   0.041005   1.397 0.162379    
## goal_conversion         6.563385   1.600541   4.101 4.12e-05 ***
## kicktohandball          1.224616   0.900988   1.359 0.174086    
## Contestedtouncontested -0.771994   1.195178  -0.646 0.518328    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 546.20  on 393  degrees of freedom
## Residual deviance: 256.91  on 380  degrees of freedom
## AIC: 284.91
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>The question is why doesn’t our model here match the paper?</p>
<ul>
<li>I’m wrong (what should I do different thoughts feedback email me!)</li>
<li>The data is different</li>
<li>reading the paper again I didn’t remove draws whoops! (now fixed)</li>
</ul>
</div>
<div id="some-possible-interesting-changes-to-make" class="section level1">
<h1>Some possible interesting changes to make</h1>
<div id="include-some-more-years-or-different-years" class="section level3">
<h3>include some more years or different years</h3>
<p>I think this makes sense as AFL is a constantly evolving game, the variables that might have been important a few years ago might not be so important now.</p>
</div>
<div id="look-at-other-data-the-authors-didnt" class="section level3">
<h3>look at other data the authors didn’t</h3>
<p>fitzRoy does have some extra variables you can try like tackles inside 50, meters gained, give it a go does it give you any extra predictive power?</p>
</div>
</div>

---
title: Age a factor?
author: Robert Nguyen
date: '2019-01-04'
slug: age-a-factor
categories:
  - fitzRoy
tags:
  - fantasy
  - fitzRoy
  - Player
description: 'Want to look at age effects but need data?'
---



<p><a href="https://github.com/jimmyday12/fitzRoy">fitzRoy</a> is as always a work in progress and I know that James and I are always keen on getting ideas on how to encourage users to produce great content that hopefully we all love to read, learn and debate.</p>
<p>One of my personal favourite bloggers <a href="https://twitter.com/MatterOfStats">Tony</a> over at <a href="http://www.matterofstats.comb">matterofstats</a> has some thoughts on age vs experience. To investigate this you need a couple of things mainly the players experience but also their age!</p>
<p>To work out age should be relatively simple you can just take their date of birth but the problem is how do you get the players date of birth?</p>
<p>So here is a quick blog post on how to get players age, for those who want to analyse it in detail. But also I think eventually it will get integrated within fitzRoy.</p>
<p>So like with anything, the first step in web-scraping the data is to first find the page you want to scrape it from, do one page and then see if we can go through all the pages that contain the data we are after.</p>
<p>An example of a page that contains all the players date of birth for the <a href="https://afltables.com/afl/stats/alltime/adelaide.html">adelaide crows</a></p>
<p>So the first step would be lets just scrape that single page.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ───────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.8
## ✔ tidyr   0.8.2     ✔ stringr 1.3.1
## ✔ readr   1.3.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ──────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(rvest)</code></pre>
<pre><code>## Loading required package: xml2</code></pre>
<pre><code>## 
## Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     pluck</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     guess_encoding</code></pre>
<pre class="r"><code>adelaide&lt;-read_html(&quot;https://afltables.com/afl/stats/alltime/adelaide.html&quot;, encoding = &quot;UTF-8&quot;)

tables&lt;-html_table(adelaide, fill = TRUE)
adelaide_crows_players&lt;-tables[[1]] 
head(adelaide_crows_players)</code></pre>
<pre><code>##   Cap  #         Player        DOB    HT   WT   Games (W-D-L) Goals
## 1  66 23 McLeod, Andrew 1976-08-04 181cm 81kg 340 (185-0-155)   275
## 2  67  9 Edwards, Tyson 1976-08-06 178cm 81kg 321 (175-0-146)   192
## 3  51 32 Ricciuto, Mark 1975-06-08 184cm 93kg 312 (162-1-149)   292
## 4  38 34      Hart, Ben 1974-07-09 190cm 83kg 311 (166-1-144)    45
## 5  16  7   Smart, Nigel 1969-05-21 188cm 91kg 278 (140-1-137)   116
## 6  77 36 Goodwin, Simon 1976-12-26 185cm 86kg 275 (155-0-120)   162
##     Seasons    Debut     Last
## 1 1995-2010 18y 274d 33y 346d
## 2 1995-2010 18y 308d 33y 303d
## 3 1993-2007 17y 326d  32y 92d
## 4 1992-2006 17y 257d  32y 49d
## 5 1991-2004 21y 305d  35y 30d
## 6 1997-2010  20y 94d 33y 202d</code></pre>
<p>So now we have an example page, the next thing we have to think about is how will we join this data onto the data in <a href="https://github.com/jimmyday12/fitzRoy">fitzRoy</a></p>
<p>Lets have a look at the player data in fitzRoy specifically the player data from afltables</p>
<pre class="r"><code>library(fitzRoy)
stats &lt;- get_afltables_stats(start_date = &quot;1990-01-01&quot;, end_date = &quot;2018-10-01&quot;)</code></pre>
<pre><code>## Returning data from 1990-01-01 to 2018-10-01</code></pre>
<pre><code>## Downloading data</code></pre>
<pre><code>## 
## Finished downloading data. Processing XMLs</code></pre>
<pre><code>## Finished getting afltables data</code></pre>
<pre class="r"><code>names(stats)</code></pre>
<pre><code>##  [1] &quot;Season&quot;                  &quot;Round&quot;                  
##  [3] &quot;Date&quot;                    &quot;Local.start.time&quot;       
##  [5] &quot;Venue&quot;                   &quot;Attendance&quot;             
##  [7] &quot;Home.team&quot;               &quot;HQ1G&quot;                   
##  [9] &quot;HQ1B&quot;                    &quot;HQ2G&quot;                   
## [11] &quot;HQ2B&quot;                    &quot;HQ3G&quot;                   
## [13] &quot;HQ3B&quot;                    &quot;HQ4G&quot;                   
## [15] &quot;HQ4B&quot;                    &quot;Home.score&quot;             
## [17] &quot;Away.team&quot;               &quot;AQ1G&quot;                   
## [19] &quot;AQ1B&quot;                    &quot;AQ2G&quot;                   
## [21] &quot;AQ2B&quot;                    &quot;AQ3G&quot;                   
## [23] &quot;AQ3B&quot;                    &quot;AQ4G&quot;                   
## [25] &quot;AQ4B&quot;                    &quot;Away.score&quot;             
## [27] &quot;First.name&quot;              &quot;Surname&quot;                
## [29] &quot;ID&quot;                      &quot;Jumper.No.&quot;             
## [31] &quot;Playing.for&quot;             &quot;Kicks&quot;                  
## [33] &quot;Marks&quot;                   &quot;Handballs&quot;              
## [35] &quot;Goals&quot;                   &quot;Behinds&quot;                
## [37] &quot;Hit.Outs&quot;                &quot;Tackles&quot;                
## [39] &quot;Rebounds&quot;                &quot;Inside.50s&quot;             
## [41] &quot;Clearances&quot;              &quot;Clangers&quot;               
## [43] &quot;Frees.For&quot;               &quot;Frees.Against&quot;          
## [45] &quot;Brownlow.Votes&quot;          &quot;Contested.Possessions&quot;  
## [47] &quot;Uncontested.Possessions&quot; &quot;Contested.Marks&quot;        
## [49] &quot;Marks.Inside.50&quot;         &quot;One.Percenters&quot;         
## [51] &quot;Bounces&quot;                 &quot;Goal.Assists&quot;           
## [53] &quot;Time.on.Ground..&quot;        &quot;Substitute&quot;             
## [55] &quot;Umpire.1&quot;                &quot;Umpire.2&quot;               
## [57] &quot;Umpire.3&quot;                &quot;Umpire.4&quot;               
## [59] &quot;group_id&quot;</code></pre>
<pre class="r"><code>tail(stats)</code></pre>
<pre><code>## # A tibble: 6 x 59
##   Season Round Date       Local.start.time Venue Attendance Home.team  HQ1G
##    &lt;dbl&gt; &lt;chr&gt; &lt;date&gt;                &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
## 1   2018 Gran… 2018-09-29             1430 &quot;M.C…     100022 West Coa…     2
## 2   2018 Gran… 2018-09-29             1430 &quot;M.C…     100022 West Coa…     2
## 3   2018 Gran… 2018-09-29             1430 &quot;M.C…     100022 West Coa…     2
## 4   2018 Gran… 2018-09-29             1430 &quot;M.C…     100022 West Coa…     2
## 5   2018 Gran… 2018-09-29             1430 &quot;M.C…     100022 West Coa…     2
## 6   2018 Gran… 2018-09-29             1430 &quot;M.C…     100022 West Coa…     2
## # ... with 51 more variables: HQ1B &lt;int&gt;, HQ2G &lt;int&gt;, HQ2B &lt;int&gt;,
## #   HQ3G &lt;int&gt;, HQ3B &lt;int&gt;, HQ4G &lt;int&gt;, HQ4B &lt;int&gt;, Home.score &lt;int&gt;,
## #   Away.team &lt;chr&gt;, AQ1G &lt;int&gt;, AQ1B &lt;int&gt;, AQ2G &lt;int&gt;, AQ2B &lt;int&gt;,
## #   AQ3G &lt;int&gt;, AQ3B &lt;int&gt;, AQ4G &lt;int&gt;, AQ4B &lt;int&gt;, Away.score &lt;int&gt;,
## #   First.name &lt;chr&gt;, Surname &lt;chr&gt;, ID &lt;dbl&gt;, Jumper.No. &lt;dbl&gt;,
## #   Playing.for &lt;chr&gt;, Kicks &lt;dbl&gt;, Marks &lt;dbl&gt;, Handballs &lt;dbl&gt;,
## #   Goals &lt;dbl&gt;, Behinds &lt;dbl&gt;, Hit.Outs &lt;dbl&gt;, Tackles &lt;dbl&gt;,
## #   Rebounds &lt;dbl&gt;, Inside.50s &lt;dbl&gt;, Clearances &lt;dbl&gt;, Clangers &lt;dbl&gt;,
## #   Frees.For &lt;dbl&gt;, Frees.Against &lt;dbl&gt;, Brownlow.Votes &lt;dbl&gt;,
## #   Contested.Possessions &lt;dbl&gt;, Uncontested.Possessions &lt;dbl&gt;,
## #   Contested.Marks &lt;dbl&gt;, Marks.Inside.50 &lt;dbl&gt;, One.Percenters &lt;dbl&gt;,
## #   Bounces &lt;dbl&gt;, Goal.Assists &lt;dbl&gt;, Time.on.Ground.. &lt;int&gt;,
## #   Substitute &lt;int&gt;, Umpire.1 &lt;chr&gt;, Umpire.2 &lt;chr&gt;, Umpire.3 &lt;chr&gt;,
## #   Umpire.4 &lt;chr&gt;, group_id &lt;int&gt;</code></pre>
<p>So looking at the data from <a href="https://github.com/jimmyday12/fitzRoy">fitzRoy</a> our best way to join on the date of births would be from joining based on player name, team playing for and season. This works best so long as there hasn’t been a team that has played two players of the same first name and last name in a game in a season.</p>
<p>So looking at what we just scraped from the <a href="https://afltables.com/afl/stats/alltime/adelaide.html">adelaide crows page on afltables</a> we have player names, the team they played for and seasons.</p>
<p>The main issue is that season is a little difficult to work with so lets edit the season column and the player name column so its a little bit easier to analyse.</p>
<div id="lets-do-the-player-name-first." class="section level1">
<h1>Lets do the player name first.</h1>
<p>In <a href="https://github.com/jimmyday12/fitzRoy">fitzRoy</a> when we use the <code>get_afltables_stats1</code> function, we have seperated player names by first name and surname columns. But when we just scraped the data from <a href="https://afltables.com/afl/afl_index.html">afltables</a> and it doesn’t appear like this.</p>
<pre class="r"><code>adelaide_crows_players&lt;- adelaide_crows_players%&gt;%
      separate(Player,c(&quot;Surname&quot;,&quot;First Name&quot;),sep=&quot;,&quot;)
head(adelaide_crows_players)</code></pre>
<pre><code>##   Cap  #  Surname First Name        DOB    HT   WT   Games (W-D-L) Goals
## 1  66 23   McLeod     Andrew 1976-08-04 181cm 81kg 340 (185-0-155)   275
## 2  67  9  Edwards      Tyson 1976-08-06 178cm 81kg 321 (175-0-146)   192
## 3  51 32 Ricciuto       Mark 1975-06-08 184cm 93kg 312 (162-1-149)   292
## 4  38 34     Hart        Ben 1974-07-09 190cm 83kg 311 (166-1-144)    45
## 5  16  7    Smart      Nigel 1969-05-21 188cm 91kg 278 (140-1-137)   116
## 6  77 36  Goodwin      Simon 1976-12-26 185cm 86kg 275 (155-0-120)   162
##     Seasons    Debut     Last
## 1 1995-2010 18y 274d 33y 346d
## 2 1995-2010 18y 308d 33y 303d
## 3 1993-2007 17y 326d  32y 92d
## 4 1992-2006 17y 257d  32y 49d
## 5 1991-2004 21y 305d  35y 30d
## 6 1997-2010  20y 94d 33y 202d</code></pre>
<p>A few football fans might wonder how hyphenate names work on <a href="https://afltables.com/afl/afl_index.html">afltables</a> the first name that popped into my head was <a href="https://afltables.com/afl/stats/players/N/Nick_Dal_Santo.html">Nick Dal Santo</a> and if we go to the <a href="https://afltables.com/afl/stats/alltime/stkilda.html">St Kilda Saints page</a> we can see that it should seperate fine.</p>
</div>
<div id="now-lets-look-at-season" class="section level1">
<h1>Now lets look at season</h1>
<p>So why is this a problem firstly?</p>
<p><a href="https://afltables.com/afl/stats/players/G/Gary_Ablett0.html">Gary</a> <a href="https://afltables.com/afl/stats/players/G/Gary_Ablett1.html">Ablett</a></p>
<pre class="r"><code>stats%&gt;%filter(First.name ==&quot;Gary&quot; &amp; Surname==&quot;Ablett&quot;)%&gt;%head()</code></pre>
<pre><code>## # A tibble: 6 x 59
##   Season Round Date       Local.start.time Venue Attendance Home.team  HQ1G
##    &lt;dbl&gt; &lt;chr&gt; &lt;date&gt;                &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
## 1   1992 8     1992-05-09             1410 Kard…      18565 Geelong      10
## 2   1993 13    1993-06-27             1738 Foot…      46496 Adelaide      6
## 3   1994 4     1994-04-17             1745 Foot…      45638 Adelaide      3
## 4   1994 19    1994-07-31             1408 Kard…      15383 Geelong       2
## 5   1995 10    1995-06-03             1410 Kard…      26314 Geelong       3
## 6   1996 18    1996-08-03             1410 Kard…      17818 Geelong       5
## # ... with 51 more variables: HQ1B &lt;int&gt;, HQ2G &lt;int&gt;, HQ2B &lt;int&gt;,
## #   HQ3G &lt;int&gt;, HQ3B &lt;int&gt;, HQ4G &lt;int&gt;, HQ4B &lt;int&gt;, Home.score &lt;int&gt;,
## #   Away.team &lt;chr&gt;, AQ1G &lt;int&gt;, AQ1B &lt;int&gt;, AQ2G &lt;int&gt;, AQ2B &lt;int&gt;,
## #   AQ3G &lt;int&gt;, AQ3B &lt;int&gt;, AQ4G &lt;int&gt;, AQ4B &lt;int&gt;, Away.score &lt;int&gt;,
## #   First.name &lt;chr&gt;, Surname &lt;chr&gt;, ID &lt;dbl&gt;, Jumper.No. &lt;dbl&gt;,
## #   Playing.for &lt;chr&gt;, Kicks &lt;dbl&gt;, Marks &lt;dbl&gt;, Handballs &lt;dbl&gt;,
## #   Goals &lt;dbl&gt;, Behinds &lt;dbl&gt;, Hit.Outs &lt;dbl&gt;, Tackles &lt;dbl&gt;,
## #   Rebounds &lt;dbl&gt;, Inside.50s &lt;dbl&gt;, Clearances &lt;dbl&gt;, Clangers &lt;dbl&gt;,
## #   Frees.For &lt;dbl&gt;, Frees.Against &lt;dbl&gt;, Brownlow.Votes &lt;dbl&gt;,
## #   Contested.Possessions &lt;dbl&gt;, Uncontested.Possessions &lt;dbl&gt;,
## #   Contested.Marks &lt;dbl&gt;, Marks.Inside.50 &lt;dbl&gt;, One.Percenters &lt;dbl&gt;,
## #   Bounces &lt;dbl&gt;, Goal.Assists &lt;dbl&gt;, Time.on.Ground.. &lt;int&gt;,
## #   Substitute &lt;int&gt;, Umpire.1 &lt;chr&gt;, Umpire.2 &lt;chr&gt;, Umpire.3 &lt;chr&gt;,
## #   Umpire.4 &lt;chr&gt;, group_id &lt;int&gt;</code></pre>
<pre class="r"><code>stats%&gt;%filter(First.name ==&quot;Gary&quot; &amp; Surname==&quot;Ablett&quot;)%&gt;%tail()</code></pre>
<pre><code>## # A tibble: 6 x 59
##   Season Round Date       Local.start.time Venue Attendance Home.team  HQ1G
##    &lt;dbl&gt; &lt;chr&gt; &lt;date&gt;                &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
## 1   2018 19    2018-07-28             1410 &quot;Kar…      28226 Geelong       2
## 2   2018 20    2018-08-03             1950 &quot;M.C…      67054 Richmond      4
## 3   2018 21    2018-08-11             1345 &quot;M.C…      59529 Hawthorn      0
## 4   2018 22    2018-08-18             1410 &quot;Kar…      24507 Geelong       1
## 5   2018 23    2018-08-25             1345 &quot;Kar…      28004 Geelong       4
## 6   2018 Elim… 2018-09-07             1950 &quot;M.C…      91767 Melbourne     5
## # ... with 51 more variables: HQ1B &lt;int&gt;, HQ2G &lt;int&gt;, HQ2B &lt;int&gt;,
## #   HQ3G &lt;int&gt;, HQ3B &lt;int&gt;, HQ4G &lt;int&gt;, HQ4B &lt;int&gt;, Home.score &lt;int&gt;,
## #   Away.team &lt;chr&gt;, AQ1G &lt;int&gt;, AQ1B &lt;int&gt;, AQ2G &lt;int&gt;, AQ2B &lt;int&gt;,
## #   AQ3G &lt;int&gt;, AQ3B &lt;int&gt;, AQ4G &lt;int&gt;, AQ4B &lt;int&gt;, Away.score &lt;int&gt;,
## #   First.name &lt;chr&gt;, Surname &lt;chr&gt;, ID &lt;dbl&gt;, Jumper.No. &lt;dbl&gt;,
## #   Playing.for &lt;chr&gt;, Kicks &lt;dbl&gt;, Marks &lt;dbl&gt;, Handballs &lt;dbl&gt;,
## #   Goals &lt;dbl&gt;, Behinds &lt;dbl&gt;, Hit.Outs &lt;dbl&gt;, Tackles &lt;dbl&gt;,
## #   Rebounds &lt;dbl&gt;, Inside.50s &lt;dbl&gt;, Clearances &lt;dbl&gt;, Clangers &lt;dbl&gt;,
## #   Frees.For &lt;dbl&gt;, Frees.Against &lt;dbl&gt;, Brownlow.Votes &lt;dbl&gt;,
## #   Contested.Possessions &lt;dbl&gt;, Uncontested.Possessions &lt;dbl&gt;,
## #   Contested.Marks &lt;dbl&gt;, Marks.Inside.50 &lt;dbl&gt;, One.Percenters &lt;dbl&gt;,
## #   Bounces &lt;dbl&gt;, Goal.Assists &lt;dbl&gt;, Time.on.Ground.. &lt;int&gt;,
## #   Substitute &lt;int&gt;, Umpire.1 &lt;chr&gt;, Umpire.2 &lt;chr&gt;, Umpire.3 &lt;chr&gt;,
## #   Umpire.4 &lt;chr&gt;, group_id &lt;int&gt;</code></pre>
<p>So these are two players who have the same name but played for the same team. So we couldn’t just join on first name and surname we need to know the season in which the player played. (This would break down the moment two players with the same name play for the same team).</p>
</div>

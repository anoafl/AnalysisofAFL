---
title : "Data Viz and Manipulation P2"
description : "A newbies guide to AFL visualisation with R P2"
author : "Robert Nguyen"
date : 2018-05-20
tags : ["fitzRoy", "graphics","R","open science" , "tidyverse"]

---



<div id="using-fitzroy-and-the-tidyverse" class="section level1">
<h1>Using fitzRoy and the tidyverse</h1>
<pre class="r"><code>library(fitzRoy)
library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages ----------------------------------------------------------------------------------------------------------------------------------------------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 2.2.1     v purrr   0.2.4
## v tibble  1.4.2     v dplyr   0.7.4
## v tidyr   0.8.0     v stringr 1.3.0
## v readr   1.1.1     v forcats 0.3.0</code></pre>
<pre><code>## -- Conflicts -------------------------------------------------------------------------------------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<p>So what we did before, was we created 3 variables from afltables about Tony Lockett. They were Year (afl season), GM (totals games played in afl season) and GL (total goals kicked in season).</p>
<p>These are summary statistics i.e. the year summaries (totals) of games played and goals kicked.</p>
<p>Something you might have noticed with <code>fitzRoy</code> is that the afldata is stored as game by game data and not season summaries.</p>
<p>So how do we create these summary statistics?</p>
</div>
<div id="step-one---get-the-dataframe-with-it-all" class="section level1">
<h1>Step One - Get the dataframe with it all</h1>
<p>Data is stored in different places in fitzRoy, afldata contains the data we are after at the moment</p>
<p><code>head(df)</code></p>
<pre class="r"><code>options(max.print=100)
df&lt;-fitzRoy::afldata</code></pre>
</div>
<div id="step-two---select-the-columns-that-you-want-select" class="section level1">
<h1>Step Two - Select the columns that you want <a href="https://dplyr.tidyverse.org/reference/select.html"><code>select</code></a></h1>
<pre class="r"><code>df%&gt;%
  select(First.name, Surname, Season, Goals)</code></pre>
<pre><code>##         First.name             Surname Season Goals
## 1             Bill               Ahern   1897     0
## 2            Jimmy              Aitken   1897     0
## 3              Bob           Armstrong   1897     0
## 4              Tom               Blake   1897     0
## 5             Otto                Buck   1897     0
## 6              Bob             Cameron   1897     0
## 7             Bill               Casey   1897     0
## 8           Arthur             Cummins   1897     0
## 9            Henry               Dunne   1897     0
## 10           Brook              Hannah   1897     0
## 11             Ted           Heffernan   1897     0
## 12          George            Johnston   1897     0
## 13           Henry            McPetrie   1897     0
## 14           Wally               OCock   1897     1
## 15             Joe               Paton   1897     0
## 16            Jack              Reekie   1897     0
## 17             Tom            Sweetman   1897     0
## 18           Ernie              Walton   1897     0
## 19            Bill                Weir   1897     1
## 20            Bill           Woodhouse   1897     0
## 21           Jimmy              Aitken   1897     0
## 22             Bob           Armstrong   1897     0
## 23             Bob             Cameron   1897     1
## 24            Bill               Casey   1897     0
## 25             Sam             Chapman   1897     0
##  [ reached getOption(&quot;max.print&quot;) -- omitted 603264 rows ]</code></pre>
</div>
<div id="step-three---create-the-grouped-data-group_by" class="section level1">
<h1>Step Three - Create the grouped data <a href="https://dplyr.tidyverse.org/reference/group_by.html"><code>group_by</code></a></h1>
<p>Now this might seem a bit weird, because on first look it would seem as though group_by doesn’t do anything.</p>
<pre class="r"><code>df%&gt;%
  select(First.name, Surname, Season, Goals)%&gt;%
  group_by(Season)</code></pre>
<pre><code>## # A tibble: 603,289 x 4
## # Groups:   Season [121]
##    First.name Surname   Season Goals
##    &lt;fct&gt;      &lt;fct&gt;      &lt;int&gt; &lt;int&gt;
##  1 Bill       Ahern       1897     0
##  2 Jimmy      Aitken      1897     0
##  3 Bob        Armstrong   1897     0
##  4 Tom        Blake       1897     0
##  5 Otto       Buck        1897     0
##  6 Bob        Cameron     1897     0
##  7 Bill       Casey       1897     0
##  8 Arthur     Cummins     1897     0
##  9 Henry      Dunne       1897     0
## 10 Brook      Hannah      1897     0
## # ... with 603,279 more rows</code></pre>
<p>It doesn’t look like our dataset has changed, but if we look closely we have a new <code>Groups:   Season [121]</code> and hopefully what you have noticed is that our dataset <code>afldata</code> has 121 unique values. Which we can check below.</p>
<pre class="r"><code>length(unique(df$Season))</code></pre>
<pre><code>## [1] 121</code></pre>
<p>What this does is adds a grouping structure to our data, which means instead of operations acting element wise like they did earlier now operations can happen by group.</p>
<p>So why would you want to group data? Well lots of interesting things are done on a <code>group_by</code> basis. For example we might be interested in goal kicking trends by <a href="https://www.foxsports.com.au/afl/afl-goalkicking-continues-to-be-under-scrutiny-as-league-accuracy-falls-to-its-worst-since-1990/news-story/b01d958a5952a86e714e7ef0a41f75d5"><code>Season</code></a> Or * by <a href="https://twitter.com/MatterOfStats/status/997814414832095237"><code>round</code></a> * by <a href="https://twitter.com/MatterOfStats/status/997814414832095237"><code>Playing.For</code></a> * by <a href="https://twitter.com/MatterOfStats/status/998017464519675904">opponent</a> * by <a href="https://twitter.com/MatterOfStats/status/998018492426141696">wins and losses</a></p>
<p>We can also <code>group_by</code> more than one thing. For example what if we wanted by <code>Season</code> and <code>Round</code></p>
<pre class="r"><code>df%&gt;%
  select(Season,Round, Goals, Behinds)%&gt;%
  group_by(Season, Round)</code></pre>
<pre><code>## # A tibble: 603,289 x 4
## # Groups:   Season, Round [2,769]
##    Season Round Goals Behinds
##     &lt;int&gt; &lt;fct&gt; &lt;int&gt;   &lt;int&gt;
##  1   1897 1         0       0
##  2   1897 1         0       0
##  3   1897 1         0       0
##  4   1897 1         0       0
##  5   1897 1         0       0
##  6   1897 1         0       0
##  7   1897 1         0       0
##  8   1897 1         0       0
##  9   1897 1         0       0
## 10   1897 1         0       0
## # ... with 603,279 more rows</code></pre>
<p>What we can now see is that we have grouped by 2 variables (Season, Round) and have formed 769 groups. <code>Groups:   Season, Round [2,769]</code></p>
</div>
<div id="step-four---take-the-grouped-data-and-summarise-it" class="section level1">
<h1>Step Four - Take the grouped data and <code>summarise</code> it</h1>
<p>So recall earlier we grouped our data by year so lets summarise it.</p>
<pre class="r"><code>df%&gt;% 
  select(First.name, Surname, Season, Goals)%&gt;%
  group_by(Season)%&gt;%
  summarise(total_goals=sum(Goals))</code></pre>
<pre><code>## # A tibble: 121 x 2
##    Season total_goals
##     &lt;int&gt;       &lt;int&gt;
##  1   1897         640
##  2   1898         721
##  3   1899         691
##  4   1900         750
##  5   1901         847
##  6   1902         878
##  7   1903         890
##  8   1904         949
##  9   1905         984
## 10   1906        1088
## # ... with 111 more rows</code></pre>
<p>Ok that doesn’t quite seem like what we were thinking we wanted the <code>total_goals</code> of Tony Lockett by season, but all we got was Season total goals.</p>
<p>Well duh! We only did a <code>group_by</code> by <code>Season</code>, we should have done it by <code>Season, First.name, Surname</code> should we have?</p>
<p>Lets check.</p>
<pre class="r"><code>df%&gt;%
  select(Season, First.name, Surname, Goals)%&gt;%
  group_by(Season, First.name, Surname)%&gt;%
  summarise(total_goals=sum(Goals))</code></pre>
<pre><code>## # A tibble: 52,466 x 4
## # Groups:   Season, First.name [?]
##    Season First.name Surname   total_goals
##     &lt;int&gt; &lt;fct&gt;      &lt;fct&gt;           &lt;int&gt;
##  1   1897 Alb        Thomas              0
##  2   1897 Alby       Patterson           0
##  3   1897 Alby       Stamp               0
##  4   1897 Alby       Tame                0
##  5   1897 Alec       Sloan               0
##  6   1897 Alex       Davidson            0
##  7   1897 Alex       Murdoch             0
##  8   1897 Alf        Bedford             0
##  9   1897 Alf        Healing             0
## 10   1897 Alf        Pontin              1
## # ... with 52,456 more rows</code></pre>
<p>This looks a lot better, only issue is that we don’t see Tony Lockett but we see all these other blokes like Alb Thomas, he didn’t kick 1,360 snags.</p>
</div>
<div id="step-five---filter-the-data" class="section level1">
<h1>Step five - <code>filter</code> the data</h1>
<pre class="r"><code>df%&gt;%
  select(Season, First.name, Surname, Goals)%&gt;%
  group_by(Season, First.name, Surname)%&gt;%
  summarise(total_goals=sum(Goals))%&gt;%
  filter(First.name==&quot;Tony&quot; , Surname==&quot;Lockett&quot;)</code></pre>
<pre><code>## # A tibble: 18 x 4
## # Groups:   Season, First.name [18]
##    Season First.name Surname total_goals
##     &lt;int&gt; &lt;fct&gt;      &lt;fct&gt;         &lt;int&gt;
##  1   1983 Tony       Lockett          19
##  2   1984 Tony       Lockett          77
##  3   1985 Tony       Lockett          79
##  4   1986 Tony       Lockett          60
##  5   1987 Tony       Lockett         117
##  6   1988 Tony       Lockett          35
##  7   1989 Tony       Lockett          78
##  8   1990 Tony       Lockett          65
##  9   1991 Tony       Lockett         127
## 10   1992 Tony       Lockett         132
## 11   1993 Tony       Lockett          53
## 12   1994 Tony       Lockett          56
## 13   1995 Tony       Lockett         110
## 14   1996 Tony       Lockett         121
## 15   1997 Tony       Lockett          37
## 16   1998 Tony       Lockett         109
## 17   1999 Tony       Lockett          82
## 18   2002 Tony       Lockett           3</code></pre>
</div>
